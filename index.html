<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Finterval – Your Fun Finance Break – Powered by Labham</title>
<meta name="description" content="Finterval by Labham – a quick, fun finance quiz. Learn, play, and share your FinScore." />
<meta name="theme-color" content="#2563eb" />

<style>
/* =========================================================
   Finterval v2.1  (Sep 2025)
   - No AI; local bank + optional questions.json
   - Colorful background (like v1), flat cards
   - Larger options & clean spacing
   - Q n of 100; 10 pts each; no repeats within session
   - RAF timer; numeric questions ≤ ~10% of session
   ========================================================= */
:root{
  --brand:#2563eb; --brand-600:#1d4ed8; --brand-700:#1e40af;
  --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e5e7eb;
  --ok:#10b981; --err:#ef4444; --warn:#f59e0b; --ring:0 0 0 3px rgba(37,99,235,.35);
}
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(37,99,235,.25), transparent 50%),
    radial-gradient(900px 700px at 110% 10%, rgba(16,185,129,.18), transparent 50%),
    var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
a{color:var(--brand)}

.container{max-width:1040px; margin:0 auto; padding:28px}
header{display:flex; align-items:flex-start; gap:16px; flex-wrap:wrap; justify-content:space-between;}
.title{display:flex; flex-direction:column}
.title h1{margin:0; letter-spacing:.3px; font-size: clamp(36px, 5.2vw, 64px); font-weight:900; line-height:1.05;
  background:linear-gradient(90deg, var(--brand) 0%, #22c55e 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
.title .tagline{margin-top:6px; font-size:clamp(16px,2.2vw,22px); font-weight:700; color:#e2e8f0}
.title .powered{margin-top:2px; font-size:13px; color:var(--muted)}
.badge{font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(37,99,235,.12); color:#cbd5e1; border:1px solid rgba(255,255,255,.10)}

.grid{display:grid; grid-template-columns:1fr; gap:32px; margin-top:28px}
@media(min-width:960px){ .grid{grid-template-columns:1.2fr .8fr} }

.card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)); border:1px solid rgba(255,255,255,.10); border-radius:20px; padding:24px}

button,.btn{appearance:none; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06);
  color:var(--text); padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:700}
button:hover,.btn:hover{border-color:rgba(255,255,255,.22)}
.btn-primary{background:linear-gradient(180deg,var(--brand),var(--brand-700)); border-color:transparent; color:#fff}
.btn-primary:hover{filter:brightness(1.05)}

.counter{color:var(--muted); font-size:13px; margin-bottom:8px}
.question{font-size: clamp(20px, 2.4vw, 26px); margin:6px 0 10px; line-height:1.35}

/* Options – big & comfy */
.choices{display:grid; gap:14px; margin-top:14px}
.choice{display:flex; align-items:center; gap:14px; width:100%; text-align:left; padding:16px; border-radius:16px;
  border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); font-size:18px}
.choice:focus-visible{outline:none; box-shadow:var(--ring)}
.key{min-width:34px; height:34px; border-radius:10px; background:rgba(255,255,255,.10); display:grid; place-items:center; font-weight:800; color:#cbd5e1}
.choice.correct{border-color:rgba(16,185,129,.65); background:rgba(16,185,129,.10)}
.choice.incorrect{border-color:rgba(239,68,68,.65); background:rgba(239,68,68,.10)}
.choice, .choice *{user-select:none; -webkit-user-select:none; -webkit-touch-callout:none}

.explain{margin-top:14px; padding:12px; border-left:4px solid rgba(255,255,255,.18); background:rgba(255,255,255,.04); border-radius:10px}
.explain.ok{border-left-color:var(--ok)}
.explain.err{border-left-color:var(--err)}

.controls{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:14px}

.side{display:grid; gap:18px}
.stat{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; border-radius:16px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04)}
.stat strong{font-size:20px}

footer{margin:22px auto 10px; text-align:center; color:var(--muted); font-size:12px}
.small{font-size:12px; color:var(--muted)}
.hidden{display:none !important}

/* Timer */
.timerWrap{margin:12px 0 8px}
.tline{height:10px; background:rgba(255,255,255,.10); border-radius:999px; overflow:hidden}
#tbar{height:100%; width:100%; background:linear-gradient(90deg, var(--warn), var(--err)); transform-origin:left center}
.ttext{margin-top:6px; font-size:13px; color:var(--muted)}
</style>
   /* 1) Score tiles shouldn't react to touches at all */
.stat { 
  pointer-events: none;            /* prevents the press highlight band */
}

/* 2) Make sure no press/selection shade appears anywhere interactive */
* { -webkit-tap-highlight-color: transparent; }
.choice, .btn, .pill {
  -webkit-user-select: none; user-select: none;
  -webkit-touch-callout: none;
}

/* 3) Compositing fix for mobile (prevents odd banding while scrolling) */
.card, .stat { 
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* 4) (Optional) Move the page gradients to a fixed layer to avoid any viewport shading */
body { background: var(--bg); }
body::before{
  content:"";
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(37,99,235,.25), transparent 50%),
    radial-gradient(900px 700px at 110% 10%, rgba(16,185,129,.18), transparent 50%),
    var(--bg);
}

</head>

<body>
  <div class="container">
    <header>
      <div class="title">
        <h1>Finterval</h1>
        <div class="tagline">Your Fun Finance Break</div>
        <div class="powered">Powered by Labham</div>
      </div>
      <span class="badge" id="bestBadge">Best FinScore: —</span>
    </header>

    <div class="grid" role="main">
      <!-- LEFT: QUIZ -->
      <section class="card" aria-live="polite">
        <div id="qCounter" class="counter">Q 1 of 100</div>
        <h2 id="question" class="question">Loading…</h2>

        <!-- Timer -->
        <div class="timerWrap">
          <div class="tline"><div id="tbar"></div></div>
          <div class="ttext">Time: <span id="tsec">20</span>s</div>
        </div>

        <div id="choices" class="choices" role="group" aria-label="Answer choices"></div>
        <div id="explain" class="explain hidden"></div>

        <div class="controls">
          <button id="nextBtn" class="btn-primary" disabled>Next</button>
          <button id="restartBtn" class="btn">Restart</button>
        </div>
      </section>

      <!-- RIGHT: SCORE + SHARE + ABOUT -->
      <aside class="side">
        <section class="card">
          <h3 style="margin-top:0">Your FinScore</h3>
          <div class="stat"><span>Score</span><strong id="scoreNow">0</strong></div>
          <div class="stat"><span>Correct</span><strong id="correctNow">0</strong></div>
          <div class="stat"><span>Streak</span><strong id="streakNow">0</strong></div>
          <div class="controls" style="margin-top:12px">
            <button id="shareBtn" class="btn-primary" title="Share your FinScore">Share</button>
          </div>
        </section>

        <section class="card">
          <h3 style="margin-top:0">About</h3>
          <p class="small">Finterval is a bite-sized finance quiz for learners and future wealth-builders. Educational only. For India-focused personal finance context.</p>
          <p class="small"><strong>Finterval is powered by Labham</strong>, AMFI Registered Mutual Fund Distributor.</p>
          <div class="controls" style="margin-top:10px">
            <a class="btn btn-primary" href="https://calendly.com/calendar-labham/finterval" target="_blank" rel="noopener">Start Investing with Labham</a>
          </div>
        </section>
      </aside>
    </div>

    <footer>© <span id="year"></span> Labham • <span class="small">Made with ❤ for clarity in money matters.</span></footer>
  </div>

  <noscript><div style="max-width:1040px;margin:8px auto;color:#ef4444;padding:8px 12px;border:1px solid rgba(239,68,68,.45);border-radius:10px;background:rgba(239,68,68,.08)">JavaScript is required to run Finterval. Please enable it in your browser.</div></noscript>
<script>
(function(){
  async function boot(){
    try{
      // =========================
      // === FUNCTIONALITIES: CONFIG (LOCAL ONLY)
      // =========================
      const CONFIG = {
        TOTAL_QUESTIONS: 25,                 // how many per run
        QUESTION_TIME: 30,                   // seconds per question
        playLink: "https://selva-vinoth-m.github.io/finterval/",
        calendly: "https://calendly.com/calendar-labham/finterval",
        bankUrl: "questions.json?v=2"        // cache-buster
      };

      // Wire footer CTA (safe)
      const bookBottom = document.getElementById('bookCallBottom');
      if (bookBottom) bookBottom.href = CONFIG.calendly;

      // Header/Badges
      const BEST_KEY = 'finterval_best';
      const bestBadge = document.getElementById('bestBadge');
      if (bestBadge) bestBadge.textContent = `Best FinScore: ${localStorage.getItem(BEST_KEY) || '—'}`;

      const aiStatus = document.getElementById('aiStatus'); // still present in your HTML
      if (aiStatus) aiStatus.textContent = 'AI: Local';

      // =========================
      // === FUNCTIONALITIES: LOAD BANK FROM questions.json
      // =========================
      let BANK = [];
      async function loadBank(){
        const res = await fetch(CONFIG.bankUrl, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP '+res.status+' fetching questions.json');
        const raw = await res.json();
        if(!Array.isArray(raw)) throw new Error('questions.json is not an array');

        // Basic validation to avoid crashes
        BANK = raw.filter(q =>
          q && typeof q.q === 'string' &&
          Array.isArray(q.options) && q.options.length === 4 &&
          Number.isInteger(q.answer) && q.answer >= 0 && q.answer < 4
        );
        if (BANK.length === 0) throw new Error('Validated questions bank is empty');
      }
      await loadBank();

      // =========================
      // === FUNCTIONALITIES: HELPERS
      // =========================
      const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
      function sampleWithoutReplacement(arr, n){
        const s = shuffle(arr.slice());
        return s.slice(0, Math.min(n, s.length));
      }
      function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

      // =========================
      // === FUNCTIONALITIES: STATE + DOM
      // =========================
      const state = { list: [], idx: 0, score: 0, correct: 0, streak: 0, answered: false, timerId: null };

      const qEl = document.getElementById('question');
      const cEl = document.getElementById('choices');
      const eEl = document.getElementById('explain');
      const nextBtn = document.getElementById('nextBtn');
      const retryBtn = document.getElementById('retryBtn');

      const qCategory = document.getElementById('qCategory');
      const qDifficulty = document.getElementById('qDifficulty');

      const tsec = document.getElementById('tsec');
      const tbar = document.getElementById('tbar');

      const scoreNow = document.getElementById('scoreNow');
      const correctNow = document.getElementById('correctNow');
      const streakNow = document.getElementById('streakNow');

      const startBtn = document.getElementById('startBtn');
      const shareBtn = document.getElementById('shareBtn');

      document.getElementById('year').textContent = new Date().getFullYear();

      // =========================
      // === FUNCTIONALITIES: TIMER
      // =========================
      function stopTimer(){ if(state.timerId){ clearInterval(state.timerId); state.timerId=null; } }
      function startTimer(){
        stopTimer();
        let left = CONFIG.QUESTION_TIME;
        if (tsec) tsec.textContent = left;
        if (tbar) tbar.style.width = '100%';

        state.timerId = setInterval(()=>{
          left -= 0.1;
          if(left<=0){
            left=0;
            if (tsec) tsec.textContent = 0;
            if (tbar) tbar.style.width = '0%';
            stopTimer();
            timeUp();
            return;
          }
          if (tsec) tsec.textContent = Math.ceil(left);
          if (tbar) tbar.style.width = `${(left/CONFIG.QUESTION_TIME)*100}%`;
        }, 100);
      }

      // =========================
      // === FUNCTIONALITIES: GAME FLOW
      // =========================
      function start(){
        stopTimer();
        state.list = sampleWithoutReplacement(BANK, CONFIG.TOTAL_QUESTIONS);
        state.idx = 0; state.score = 0; state.correct = 0; state.streak = 0; state.answered = false;
        if (scoreNow) scoreNow.textContent = 0;
        if (correctNow) correctNow.textContent = 0;
        if (streakNow) streakNow.textContent = 0;
        if (eEl){ eEl.classList.add('hidden'); eEl.textContent = ''; }
        render();
      }

      function render(){
        const q = state.list[state.idx];
        if(!q){
          if(qEl) qEl.textContent = 'No questions loaded.';
          if(nextBtn) nextBtn.disabled = true;
          return;
        }
        // Show 1/25, 2/25, …
        if(qEl) qEl.textContent = `(${state.idx+1}/${state.list.length}) ${q.q}`;
        if(qCategory) qCategory.textContent = `Category: ${q.cat || '—'}`;
        if(qDifficulty) qDifficulty.textContent = `Level: ${q.difficulty || '—'}`;

        if(cEl) cEl.innerHTML = '';
        if(eEl){ eEl.classList.add('hidden'); eEl.textContent=''; }
        if(nextBtn) nextBtn.disabled = true;
        state.answered = false;

        (q.options || []).slice(0,4).forEach((opt,i)=>{
          const btn = document.createElement('button');
          btn.className = 'choice';
          btn.innerHTML = `<span class="key">${String.fromCharCode(65+i)}</span><span>${opt}</span>`;
          btn.addEventListener('click', ()=>handleAnswer(i));
          cEl.appendChild(btn);
        });

        startTimer();
      }

      function handleAnswer(i){
        if(state.answered) return;
        state.answered = true;
        stopTimer();

        const q = state.list[state.idx];
        Array.from(cEl.children).forEach((btn,idx)=>{
          btn.disabled = true;
          if(idx === q.answer) btn.classList.add('correct');
          if(idx === i && i !== q.answer) btn.classList.add('incorrect');
        });

        const ok = i === q.answer;
        if(ok){ state.correct++; state.streak++; state.score += 10; if(eEl) eEl.className='explain ok'; }
        else { state.streak=0; if(eEl) eEl.className='explain err'; }
        if(eEl){
          eEl.innerHTML = `<strong>${ok ? 'Correct!' : 'Not quite.'}</strong> ${q.explain || ''}`;
          eEl.classList.remove('hidden');
        }

        if(correctNow) correctNow.textContent = state.correct;
        if(streakNow)  streakNow.textContent = state.streak;
        if(scoreNow)   scoreNow.textContent = state.score;

        // update Best badge
        const best = parseInt(localStorage.getItem(BEST_KEY)||'0',10);
        if(state.score > best){
          localStorage.setItem(BEST_KEY, String(state.score));
          if (bestBadge) bestBadge.textContent = `Best FinScore: ${state.score}`;
        }

        if(nextBtn) nextBtn.disabled = false;
      }

      function timeUp(){
        if(state.answered) return;
        state.answered = true;
        const q = state.list[state.idx];
        Array.from(cEl.children).forEach((btn,idx)=>{ btn.disabled = true; if(idx===q.answer) btn.classList.add('correct'); });
        state.streak = 0;
        if(eEl){
          eEl.className='explain err';
          eEl.innerHTML = `<strong>Time’s up!</strong> ${q.explain || ''}`;
          eEl.classList.remove('hidden');
        }
        if(nextBtn) nextBtn.disabled = false;
      }

      // Buttons
      if(nextBtn){
        nextBtn.addEventListener('click', ()=>{
          if(state.idx < state.list.length - 1){ state.idx++; render(); }
          else { finish(); }
        });
      }
      if(retryBtn){ retryBtn.addEventListener('click', start); }
      if(startBtn){ startBtn.addEventListener('click', start); }

      if(shareBtn){
        shareBtn.addEventListener('click', async ()=>{
          const pct = state.list.length ? Math.round((state.correct/state.list.length)*100) : 0;
          const text = `My Finterval Score: ${state.score} (${pct}% correct). Play here: ${CONFIG.playLink}`;
          try{
            if(navigator.share){ await navigator.share({title:'Finterval – Labham', text}); }
            else { await navigator.clipboard.writeText(text); alert('Copied result to clipboard!'); }
          }catch{}
        });
      }

      function finish(){
        stopTimer();
        if(nextBtn) nextBtn.disabled = true;
        if(retryBtn) retryBtn.classList.remove('hidden');
        const pct = Math.round((state.correct / state.list.length) * 100);
        alert(`Your FinScore: ${state.score} — ${pct}% correct`);
      }

      // GO
      start();

    } catch(err){
      console.error('Finterval loader error:', err);
      const qEl = document.getElementById('question');
      if(qEl){ qEl.textContent = 'Error loading questions. Please refresh.'; }
    }
  }

  if(document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', boot); }
  else { boot(); }
})();
</script>

</body>
</html>
