<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Finterval – Your Fun Finance Break – Powered by Labham</title>
<meta name="description" content="Finterval by Labham – a quick, fun finance quiz. Learn, play, and share your FinScore." />
<meta name="theme-color" content="#2563eb" />

<style>
/* =========================================================
   Finterval v2 (flat UI) — Sep 2025
   - Clean header, no meta pills
   - Larger options, Restart next to Next
   - Share below FinScore
   - Flat (no gradients/shades), no mobile highlight band
   ========================================================= */
:root{
  --brand:#2563eb; --brand-600:#1d4ed8;
  --bg:#0b1220; --card:#0f172a;
  --muted:#94a3b8; --text:#e5e7eb;
  --ok:#10b981; --err:#ef4444; --warn:#f59e0b;
  --ring: 0 0 0 3px rgba(37,99,235,.35);
}
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  background: var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
a{color:var(--brand)}

.container{max-width:1040px; margin:0 auto; padding:24px}
header{display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:space-between;}
.brand{display:flex; align-items:center; gap:8px}
.title{display:flex; flex-direction:column}
.title h1{margin:0; letter-spacing:.3px; font-size: clamp(34px, 5.2vw, 64px); font-weight:900; line-height:1.05}
.title .tagline{margin-top:4px; font-size:clamp(16px,2.2vw,22px); font-weight:700; color:#e2e8f0}
.title .powered{margin-top:2px; font-size:13px; color:var(--muted)}
.badge{font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.04); color:#cbd5e1; border:1px solid rgba(255,255,255,.10)}

.card{background:var(--card); border:1px solid rgba(255,255,255,.10); border-radius:20px; padding:20px}
.grid{display:grid; grid-template-columns:1fr; gap:28px; margin-top:24px}
@media(min-width:960px){ .grid{grid-template-columns:1.2fr .8fr} }

button,.btn{appearance:none; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text); padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:700}
button:hover,.btn:hover{border-color:rgba(255,255,255,.24)}
.btn-primary{background:var(--brand); border-color:var(--brand); color:#fff}
.btn-primary:hover{background:var(--brand-600); border-color:var(--brand-600)}
.controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

.counter{color:var(--muted); font-size:13px; margin-bottom:6px}
.question{font-size: clamp(20px, 2.4vw, 26px); margin:4px 0 8px; line-height:1.35}

/* Options – bigger, easy to tap */
.choices{display:grid; gap:12px; margin-top:12px}
.choice{display:flex; align-items:center; gap:12px; width:100%; text-align:left; padding:16px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:transparent; font-size:18px}
.choice:focus-visible{outline:none; box-shadow:var(--ring)}
.key{min-width:34px; height:34px; border-radius:8px; background:rgba(255,255,255,.08); display:grid; place-items:center; font-weight:800; color:#cbd5e1}
.choice.correct{border-color:rgba(16,185,129,.65); background:rgba(16,185,129,.10)}
.choice.incorrect{border-color:rgba(239,68,68,.65); background:rgba(239,68,68,.08)}
/* Disable selection to avoid blue/grey bands on mobile */
.choice, .choice *{user-select:none; -webkit-user-select:none; -webkit-touch-callout:none}

.explain{margin-top:12px; padding:12px; border-left:4px solid rgba(255,255,255,.12); background:transparent; border-radius:10px}
.explain.ok{border-left-color:var(--ok)}
.explain.err{border-left-color:var(--err)}

.side{display:grid; gap:16px; height:fit-content}
.stat{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:transparent; pointer-events:none}
.stat strong{font-size:20px}

footer{margin:20px auto 8px; text-align:center; color:var(--muted); font-size:12px}
.small{font-size:12px; color:var(--muted)}
.hidden{display:none !important}

/* Timer – flat */
.timerWrap{margin:10px 0 6px}
.tline{height:8px; background:rgba(255,255,255,.10); border-radius:999px; overflow:hidden}
#tbar{height:100%; width:100%; background:var(--warn); transform-origin:left center}
.ttext{margin-top:6px; font-size:13px; color:var(--muted)}
</style>
</head>

<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="title">
          <h1>Finterval</h1>
          <div class="tagline">Your Fun Finance Break</div>
          <div class="powered">Powered by Labham</div>
        </div>
      </div>
      <span class="badge" id="bestBadge">Best FinScore: —</span>
    </header>

    <div class="grid" role="main">
      <!-- LEFT: QUIZ -->
      <section class="card" aria-live="polite">
        <div id="qCounter" class="counter">Q 1 of 100</div>
        <h2 id="question" class="question">Loading…</h2>

        <!-- Timer -->
        <div class="timerWrap">
          <div class="tline"><div id="tbar"></div></div>
          <div class="ttext">Time: <span id="tsec">20</span>s</div>
        </div>

        <div id="choices" class="choices" role="group" aria-label="Answer choices"></div>
        <div id="explain" class="explain hidden"></div>

        <div class="controls" style="margin-top:12px">
          <button id="nextBtn" class="btn-primary" disabled>Next</button>
          <button id="restartBtn" class="btn">Restart</button>
        </div>
      </section>

      <!-- RIGHT: SCORE + SHARE + ABOUT -->
      <aside class="side">
        <section class="card">
          <h3 style="margin-top:0">Your FinScore</h3>
          <div class="stat"><span>Score</span><strong id="scoreNow">0</strong></div>
          <div class="stat"><span>Correct</span><strong id="correctNow">0</strong></div>
          <div class="stat"><span>Streak</span><strong id="streakNow">0</strong></div>
          <div class="controls">
            <button id="shareBtn" class="btn" title="Share your FinScore">Share</button>
          </div>
        </section>

        <section class="card">
          <h3 style="margin-top:0">About</h3>
          <p class="small">Finterval is a bite-sized finance quiz for learners and future wealth-builders. Educational only. For India-focused personal finance context.</p>
          <p class="small"><strong>Finterval is powered by Labham</strong>, AMFI Registered Mutual Fund Distributor.</p>
          <div class="controls" style="margin-top:10px">
            <a class="btn btn-primary" href="https://calendly.com/calendar-labham/finterval" target="_blank" rel="noopener">Start Investing with Labham</a>
          </div>
        </section>
      </aside>
    </div>

    <footer>
      © <span id="year"></span> Labham • <span class="small">Made with ❤ for clarity in money matters.</span>
    </footer>
  </div>

  <noscript><div style="max-width:1040px;margin:8px auto;color:#ef4444;padding:8px 12px;border:1px solid rgba(239,68,68,.45);border-radius:10px;background:rgba(239,68,68,.08)">JavaScript is required to run Finterval. Please enable it in your browser.</div></noscript>

<script>
/* =========================================================
   Finterval v2 logic
   - Non-repeating questions within a session
   - 10 points per correct (no streak bonus)
   - Option order shuffled per question (fixes B/C bias)
   - Smooth RAF timer (no back/forth)
   - Fixed-length session: 100 Q (shows 1/100, 2/100…)
   - Share text updated with link
   - AI backend optional, falls back to local 300-question bank
   ========================================================= */
(function(){
  // ---------- CONFIG ----------
  const CONFIG = {
    SESSION_TOTAL: 100,                      // show 1/100, 2/100…
    TIME_PER_Q: 20,                          // seconds
    BACKEND_URL: "https://script.google.com/macros/s/AKfycbwqZyaWQ1pH9e5US0h69mSccgI2jneLkcwDGwe6Csrj9DbYva8gKevGn9oiLxDgnbQh/exec",
    USE_AI: true,                            // try AI first
    AI_BATCH: 50                             // how many to ask from AI in one call
  };

  // ---------- DOM ----------
  const qCounter = document.getElementById('qCounter');
  const qEl      = document.getElementById('question');
  const cEl      = document.getElementById('choices');
  const eEl      = document.getElementById('explain');
  const nextBtn  = document.getElementById('nextBtn');
  const restartBtn = document.getElementById('restartBtn');

  const tsec = document.getElementById('tsec');
  const tbar = document.getElementById('tbar');

  const scoreNow   = document.getElementById('scoreNow');
  const correctNow = document.getElementById('correctNow');
  const streakNow  = document.getElementById('streakNow');

  const BEST_KEY = 'finterval_best';
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('bestBadge').textContent =
    `Best FinScore: ${localStorage.getItem(BEST_KEY) || '—'}`;

  // ---------- UTILS ----------
  const rnd = (min,max)=> Math.floor(Math.random()*(max-min+1))+min;
  const shuffleInPlace = (a)=>{
    for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a;
  };
  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));

  // ---------- BANK (base) ----------
  // Small curated base:
  const BASE = [
    {cat:'basics',difficulty:'Easy',q:'What does SIP stand for in mutual funds?',options:['Systematic Investment Plan','Savings & Insurance Plan','Secure Income Portfolio','Scheduled Investment Period'],answer:0,explain:'SIP = investing a fixed amount at regular intervals.'},
    {cat:'invest',difficulty:'Easy',q:'ELSS mutual funds have a mandatory lock-in of:',options:['1 year','3 years','5 years','No lock-in'],answer:1,explain:'ELSS lock-in is 3 years.'},
    {cat:'tax',difficulty:'Easy',q:'KYC stands for:',options:['Know Your Customer','Keep Your Credit','Key Yield Certificate','Know Your Capital'],answer:0,explain:'Customer identification before investing.'},
    {cat:'india',difficulty:'Easy',q:'India’s capital market regulator is:',options:['RBI','SEBI','IRDAI','PFRDA'],answer:1,explain:'SEBI regulates securities markets.'},
    {cat:'basics',difficulty:'Easy',q:'CAGR stands for:',options:['Cumulative Annual Gross Return','Compound Annual Growth Rate','Computed Average Growth Rate','Consolidated Annual Gain Rate'],answer:1,explain:'Smoothed annual growth rate with compounding.'},
    {cat:'invest',difficulty:'Easy',q:'Index funds primarily aim to:',options:['Beat the market','Replicate a benchmark','Hold only bonds','Time the market'],answer:1,explain:'They track an index like Nifty 50.'},
    {cat:'basics',difficulty:'Medium',q:'Diversification mainly reduces:',options:['Systematic (market) risk','Unsystematic (stock-specific) risk','Taxes','Inflation'],answer:1,explain:'Company/sector specific risk gets diversified.'},
    {cat:'india',difficulty:'Easy',q:'PPF typically matures in:',options:['5 years','10 years','15 years','20 years'],answer:2,explain:'15-year maturity with extension options.'},
    {cat:'invest',difficulty:'Medium',q:'Expense ratio of a fund:',options:['Increases net returns','Reduces net returns','No impact','Paid by government'],answer:1,explain:'Fees are deducted from assets.'},
    {cat:'basics',difficulty:'Easy',q:'An emergency fund is typically:',options:['Illiquid investment','3–6 months of expenses','2 years of salary','Crypto only'],answer:1,explain:'Safety + liquidity is key.'}
  ];

  // Programmatic generator for extra unique Qs (no AI)
  function makeComputedBank(n=220){
    const out=[];
    for(let k=0;k<n;k++){
      const kind = k%4;
      if(kind===0){
        // CAGR from start to end over years
        const start = rnd(10,200)*1000;
        const years = rnd(2,8);
        const rate  = rnd(6,15);
        const end   = Math.round(start*Math.pow(1+rate/100,years));
        const ans   = rate;
        const opts  = shuffleInPlace([ans, ans+rnd(1,4), Math.max(2,ans-rnd(1,4)), ans+rnd(5,8)]);
        out.push({
          cat:'basics', difficulty:'Medium',
          q:`If ₹${start.toLocaleString()} grows to about ₹${end.toLocaleString()} in ${years} years, the CAGR is closest to:`,
          options: opts.map(x=>`${x}%`),
          answer: opts.indexOf(ans),
          explain:`CAGR ≈ (End/Start)^(1/${years}) − 1 ≈ ${ans}%.`
        });
      } else if(kind===1){
        // Future value with compounding
        const p=rnd(5,50)*1000, r=rnd(5,12), y=rnd(2,7);
        const fv=Math.round(p*Math.pow(1+r/100,y));
        const opts=shuffleInPlace([fv, Math.round(fv*0.9), Math.round(fv*1.1), Math.round(fv*0.8)]);
        out.push({
          cat:'invest', difficulty:'Easy',
          q:`Approx future value of ₹${p.toLocaleString()} at ${r}% p.a. for ${y} years (annual compounding)?`,
          options: opts.map(v=>"₹"+v.toLocaleString()),
          answer: opts.indexOf(fv),
          explain:`FV = P×(1+r)^n.`
        });
      } else if(kind===2){
        // Risk order
        const sets = [
          {q:'Which is typically the lowest short-term risk?', opts:['Overnight fund','Small-cap equity','Crypto','Sectoral equity'], ans:0, cat:'invest'},
          {q:'Which is generally the highest short-term volatility?', opts:['Liquid fund','Arbitrage fund','Equity small-cap fund','Overnight fund'], ans:2, cat:'invest'},
          {q:'A suitable parking place for emergency corpus is usually:', opts:['Equity mid-cap','Liquid/Overnight fund','Real estate','Penny stocks'], ans:1, cat:'basics'}
        ];
        const pick = sets[rnd(0,sets.length-1)];
        const order = shuffleInPlace([0,1,2,3]);
        out.push({
          cat:pick.cat, difficulty:'Easy',
          q:pick.q,
          options: order.map(i=>pick.opts[i]),
          answer: order.indexOf(pick.ans),
          explain:'Based on typical risk characteristics.'
        });
      } else {
        // India finance trivia set
        const sets = [
          {q:'Who regulates securities markets in India?', opts:['RBI','SEBI','IRDAI','PFRDA'], ans:1},
          {q:'ELSS lock-in period is:', opts:['1 year','3 years','5 years','No lock-in'], ans:1},
          {q:'UPI stands for:', opts:['Unified Payments Interface','Universal Payment Instruction','User Payment Index','Unified Pricing Info'], ans:0},
          {q:'SGB normal maturity is:', opts:['3 years','5 years','8 years','12 years'], ans:2}
        ];
        const pick=sets[rnd(0,sets.length-1)];
        const order=shuffleInPlace([0,1,2,3]);
        out.push({
          cat:'india', difficulty:'Easy',
          q:pick.q,
          options:order.map(i=>pick.opts[i]),
          answer:order.indexOf(pick.ans),
          explain:'Standard Indian finance fact.'
        });
      }
    }
    return out;
  }

  // Build a ~300-question local pool
  const LOCAL_BANK = BASE.concat(makeComputedBank(290 - BASE.length)); // ≈290–300 total

  // ---------- STATE ----------
  const state = {
    sessionTotal: CONFIG.SESSION_TOTAL,
    list: [],           // questions for this session (AI + local), prebuilt without repeats
    idx: 0,
    score: 0,
    correct: 0,
    streak: 0,
    answered: false,
    rafId: null,
    endTime: 0
  };

  // ---------- AI fetch (optional) ----------
  async function getAIQuestions(want){
    if(!CONFIG.USE_AI || !CONFIG.BACKEND_URL) return [];
    try{
      const r = await fetch(CONFIG.BACKEND_URL, {
        method:'POST',
        headers:{'Content-Type':'text/plain'},
        body: JSON.stringify({ total: clamp(want, 1, CONFIG.AI_BATCH) })
      });
      const txt = await r.text();
      let arr=[]; try{ arr=JSON.parse(txt); }catch{ /* ignore */ }
      if(!Array.isArray(arr)) return [];
      // sanitize & cap to 4 options
      return arr.map((x,i)=>({
        id: 90000+i,
        cat: x.cat || 'basics',
        difficulty: x.difficulty || 'Easy',
        q: String(x.q||''),
        options: Array.isArray(x.options) ? x.options.slice(0,4).map(String) : [],
        answer: Number.isInteger(x.answer) ? x.answer : 0,
        explain: String(x.explain||'')
      })).filter(q=>q.q && q.options.length===4);
    }catch(e){
      return [];
    }
  }

  // ---------- Session builder (no repeats) ----------
  async function buildSession(){
    // try AI first
    const ai = await getAIQuestions(state.sessionTotal);
    const pool = ai.concat(LOCAL_BANK); // fallback appended
    // dedupe by "q" text
    const seen = new Set();
    const session=[];
    for(const q of pool){
      if(!q || !q.q) continue;
      const key = q.q.trim().toLowerCase();
      if(seen.has(key)) continue;
      seen.add(key);
      // shuffle options per question to avoid B/C bias
      const order=[0,1,2,3]; shuffleInPlace(order);
      const shuffled=order.map(i=>q.options[i]);
      const ans=order.indexOf(q.answer);
      session.push({cat:q.cat,difficulty:q.difficulty,q:q.q,options:shuffled,answer:ans,explain:q.explain});
      if(session.length>=state.sessionTotal) break;
    }
    return session;
  }

  // ---------- Timer (requestAnimationFrame – smooth, no oscillation) ----------
  function stopTimer(){ if(state.rafId){ cancelAnimationFrame(state.rafId); state.rafId=null; } }
  function startTimer(){
    stopTimer();
    const durMs = CONFIG.TIME_PER_Q*1000;
    const start = performance.now();
    state.endTime = start + durMs;

    function tick(now){
      const left = Math.max(0, state.endTime - now);
      tsec.textContent = Math.ceil(left/1000);
      const pct = left / durMs;
      // set width via transform (smoother)
      tbar.style.transform = `scaleX(${pct})`;
      if(left<=0){ stopTimer(); timeUp(); return; }
      state.rafId = requestAnimationFrame(tick);
    }
    // reset bar and begin
    tbar.style.transform = 'scaleX(1)';
    state.rafId = requestAnimationFrame(tick);
  }

  // ---------- Rendering ----------
  function render(){
    const q = state.list[state.idx];
    if(!q){ qEl.textContent='Loading…'; nextBtn.disabled=true; return; }
    qCounter.textContent = `Q ${state.idx+1} of ${state.sessionTotal}`;
    qEl.textContent = q.q;
    cEl.innerHTML = '';
    eEl.classList.add('hidden'); eEl.textContent='';
    nextBtn.disabled = true;
    state.answered = false;

    q.options.forEach((opt,i)=>{
      const btn=document.createElement('button');
      btn.className='choice';
      btn.innerHTML=`<span class="key">${String.fromCharCode(65+i)}</span><span>${opt}</span>`;
      btn.addEventListener('click',()=>handleAnswer(i));
      cEl.appendChild(btn);
    });

    startTimer();
  }

  function handleAnswer(i){
    if(state.answered) return;
    state.answered = true;
    stopTimer();

    const q = state.list[state.idx];
    const nodes = Array.from(cEl.children);
    nodes.forEach((btn,idx)=>{
      btn.disabled = true;
      if(idx===q.answer) btn.classList.add('correct');
      if(idx===i && i!==q.answer) btn.classList.add('incorrect');
    });

    const ok = i===q.answer;
    if(ok){ state.correct++; state.streak++; state.score += 10; eEl.className='explain ok'; }
    else  { state.streak=0; eEl.className='explain err'; }
    eEl.innerHTML = `<strong>${ok ? 'Correct!' : 'Not quite.'}</strong> ${q.explain||''}`;
    eEl.classList.remove('hidden');

    correctNow.textContent = state.correct;
    streakNow.textContent  = state.streak;
    scoreNow.textContent   = state.score;

    // Update best
    const best = parseInt(localStorage.getItem(BEST_KEY)||'0',10);
    if(state.score>best){
      localStorage.setItem(BEST_KEY, String(state.score));
      document.getElementById('bestBadge').textContent = `Best FinScore: ${state.score}`;
    }

    nextBtn.disabled=false;
  }

  function timeUp(){
    if(state.answered) return;
    state.answered = true;
    const q = state.list[state.idx];
    Array.from(cEl.children).forEach((btn,idx)=>{ btn.disabled=true; if(idx===q.answer) btn.classList.add('correct'); });
    state.streak=0; eEl.className='explain err';
    eEl.innerHTML = `<strong>Time’s up!</strong> ${q.explain||''}`;
    eEl.classList.remove('hidden');
    nextBtn.disabled = false;
  }

  // ---------- Flow ----------
  nextBtn.addEventListener('click',()=>{
    if(state.idx < state.sessionTotal-1){
      state.idx++;
      render();
    }else{
      finish();
    }
  });

  restartBtn.addEventListener('click', start);

  document.getElementById('shareBtn').addEventListener('click', async ()=>{
    const asked = state.idx + (state.answered?1:0);
    const pct = asked ? Math.round((state.correct/asked)*100) : 0;
    const text = `My Finterval Score — ${state.score} (${pct}% correct). Play: https://selva-vinoth-m.github.io/finterval/`;
    try{
      if(navigator.share){ await navigator.share({title:'Finterval – Labham', text}); }
      else { await navigator.clipboard.writeText(text); alert('Copied result to clipboard!'); }
    }catch{}
  });

  function finish(){
    stopTimer();
    nextBtn.disabled=true;
    eEl.className='explain ok';
    const pct = Math.round((state.correct/state.sessionTotal)*100);
    eEl.innerHTML = `<strong>Session complete!</strong> You scored ${state.score} with ${state.correct}/${state.sessionTotal} correct (${pct}%).`;
    eEl.classList.remove('hidden');
  }

  async function start(){
    stopTimer();
    state.idx=0; state.score=0; state.correct=0; state.streak=0; state.answered=false;
    scoreNow.textContent=0; correctNow.textContent=0; streakNow.textContent=0;
    eEl.classList.add('hidden'); eEl.textContent='';
    qEl.textContent='Loading…';
    // Build a new non-repeating session
    state.list = await buildSession();
    render();
  }

  // boot!
  start();
})();
</script>
</body>
</html>
